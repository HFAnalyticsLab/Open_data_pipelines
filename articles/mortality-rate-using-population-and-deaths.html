<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the monstR package to estimate the mortality rate in England and Wales • monstR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the monstR package to estimate the mortality rate in England and Wales">
<meta property="og:description" content="monstR">
<meta property="og:image" content="/reference/figures/monstR_sticker.png">
<meta property="og:image:alt" content="The logo for the monstR package - a grey monster">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@gummifot">
<meta name="twitter:site" content="@HealthFdn">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">monstR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mortality-rate-using-population-and-deaths.html">Using the monstR package to estimate the mortality rate in England and Wales</a>
    </li>
    <li>
      <a href="../articles/pipeline.html">Quick start</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mortality-rate-using-population-and-deaths_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="mortality-rate-using-population-and-deaths_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="mortality-rate-using-population-and-deaths_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the monstR package to estimate the mortality rate in England and Wales</h1>
                        <h4 class="author">Sebastien Peytrignet</h4>
            
            <h4 class="date">2020-11-16</h4>
      
      
      <div class="hidden name"><code>mortality-rate-using-population-and-deaths.Rmd</code></div>

    </div>

    
    
<div id="vignette-background" class="section level2">
<h2 class="hasAnchor">
<a href="#vignette-background" class="anchor"></a>Vignette background</h2>
<p>The <code>monstR</code> package interacts with the UK’s Office for National Statistics (ONS) API, enabling us to easily extract their datasets for analysis. In this vignette, we will demonstrate how to use <code>monstR</code> to download the following ONS tables:</p>
<ul>
<li>Mid-year population estimates by region, age and gender</li>
<li>Deaths registered weekly in England and Wales by region</li>
</ul>
<p>We will then merge both of those datasets to compute a time-series of mortality rates in England and Wales by sub-region. We will also plot those statistics.</p>
</div>
<div id="find-identifiers-for-desired-ons-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#find-identifiers-for-desired-ons-datasets" class="anchor"></a>Find identifiers for desired ONS datasets</h2>
<p>The function <code><a href="../reference/ons_available_datasets.html">ons_available_datasets()</a></code> is useful to find out what datasets are available through the ONS API.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ons_available_datasets.html">ons_available_datasets</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Each dataset is associated with an identifier, which we can retrieve by inspecting the output from <code><a href="../reference/ons_available_datasets.html">ons_available_datasets()</a></code>. First, we will extract the identifier for the desired population dataset (‘Mid-year population estimates by region, age and gender’).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">population_id</span> <span class="op">&lt;-</span> <span class="va">datasets</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>,<span class="st">'population estimates for uk'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>

<span class="va">population_id</span>

<span class="va">datasets</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">%in%</span> <span class="va">population_id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">title</span><span class="op">)</span></code></pre></div>
<p>Then, we will do the same for our desired dataset recording deaths by region.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mortality_id</span> <span class="op">&lt;-</span> <span class="va">datasets</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>,<span class="st">'deaths'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>,<span class="st">'by region'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">pull</span><span class="op">(</span><span class="va">id</span><span class="op">)</span>

<span class="va">mortality_id</span>

<span class="va">datasets</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">%in%</span> <span class="va">mortality_id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">title</span><span class="op">)</span></code></pre></div>
</div>
<div id="browse-editions-and-versions-available-for-each-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#browse-editions-and-versions-available-for-each-dataset" class="anchor"></a>Browse editions and versions available for each dataset</h2>
<p>ONS datasets are usually associated with multiple editions and versions. Different editions may contain different variables or be presented in different formats, while versions usually refresh or update the content with new data points. Before downloading a dataset with <code>monstR</code>, it is recommended to know beforehand which edition and version you would like to donwload.</p>
<p>The function <code>ons_available_editions</code> returns available editions, while <code>ons_available_versions</code> return available versions.</p>
<p>We will check the editions and versions associated with the population dataset.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### Editions available for the population dataset</span>
<span class="va">ids_and_editions_pop</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="va">population_id</span>, <span class="va">ons_available_editions</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">set_names</span><span class="op">(</span><span class="va">population_id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">bind_rows</span><span class="op">(</span>.id<span class="op">=</span><span class="st">'id'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="va">.</span>,id_edition<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">id</span>,<span class="va">edition</span>,sep<span class="op">=</span><span class="st">"-"</span><span class="op">)</span><span class="op">)</span>

<span class="va">ids_and_editions_pop</span>

<span class="co">### Versions available for each edition</span>
<span class="va">ids_and_editions_and_versions_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span>id<span class="op">=</span><span class="va">ids_and_editions_pop</span><span class="op">$</span><span class="va">id</span>,
                                        edition<span class="op">=</span><span class="va">ids_and_editions_pop</span><span class="op">$</span><span class="va">edition</span>,
                                        <span class="va">ons_available_versions</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ids_and_editions_and_versions_pop</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ids_and_editions_pop</span><span class="op">$</span><span class="va">id_edition</span>

<span class="va">ids_and_editions_and_versions_pop</span></code></pre></div>
<p>From the dataset with identifier <code>mid-year-pop</code> we would like to download edition <code>mid-2018-april-2019-geography</code> and version <code>1</code>.</p>
<p>We will also explore editins and vesions for the deaths dataset.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### Editions available for the deaths dataset</span>
<span class="va">ids_and_editions_deaths</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="va">mortality_id</span>, <span class="va">ons_available_editions</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">set_names</span><span class="op">(</span><span class="va">mortality_id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">bind_rows</span><span class="op">(</span>.id<span class="op">=</span><span class="st">'id'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="va">.</span>,id_edition<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">id</span>,<span class="va">edition</span>,sep<span class="op">=</span><span class="st">"-"</span><span class="op">)</span><span class="op">)</span>

<span class="va">ids_and_editions_deaths</span>

<span class="co">### Versions available for each edition</span>
<span class="va">ids_and_editions_and_versions_deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span>id<span class="op">=</span><span class="va">ids_and_editions_deaths</span><span class="op">$</span><span class="va">id</span>,
                                        edition<span class="op">=</span><span class="va">ids_and_editions_deaths</span><span class="op">$</span><span class="va">edition</span>,
                                        <span class="va">ons_available_versions</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ids_and_editions_and_versions_deaths</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ids_and_editions_deaths</span><span class="op">$</span><span class="va">id_edition</span>

<span class="va">ids_and_editions_and_versions_deaths</span></code></pre></div>
<p>From the dataset with identifier <code>weekly-deaths-local-authority</code> we would like to download edition <code>2010-19</code> and version <code>1</code>.</p>
</div>
<div id="download-both-ons-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#download-both-ons-datasets" class="anchor"></a>Download both ONS datasets</h2>
<p>After inspection in the previous step, we have decided which edition and version pair we would like to download for each dataset.</p>
<p>The following command sets up the pipeline using the <code>monstR</code> default settings.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">set_up_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monstr_pipeline_defaults.html">monstr_pipeline_defaults</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/ons_datasets_setup.html">ons_datasets_setup</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We feed the edition and version to function <code>ons_dataset_by_id</code>, while <code>ons_download</code> downloads the data. Additional functions <code>monstr_read_file</code>, <code>monstr_clean</code> and <code>monstr_write_clean</code> read, clean and write the desired datasets.</p>
<p>We can now download our population dataset.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">set_up_df</span> <span class="op">%&gt;%</span>
<span class="fu"><a href="../reference/ons_dataset_by_id.html">ons_dataset_by_id</a></span><span class="op">(</span>id<span class="op">=</span><span class="va">population_id</span>,edition<span class="op">=</span><span class="st">"mid-2019-april-2020-geography"</span>,version<span class="op">=</span><span class="fl">1</span><span class="op">)</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/ons_download.html">ons_download</a></span><span class="op">(</span>format<span class="op">=</span><span class="st">"csv"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/monstr_read_file.html">monstr_read_file</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="../reference/monstr_clean.html">monstr_clean</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/monstr_write_clean.html">monstr_write_clean</a></span><span class="op">(</span>format<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></code></pre></div>
<p>And our deaths dataset.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">set_up_df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/ons_dataset_by_id.html">ons_dataset_by_id</a></span><span class="op">(</span>id<span class="op">=</span><span class="va">mortality_id</span>,edition<span class="op">=</span><span class="st">"2010-19"</span>,version<span class="op">=</span><span class="fl">1</span><span class="op">)</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/ons_download.html">ons_download</a></span><span class="op">(</span>format<span class="op">=</span><span class="st">"csv"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/monstr_read_file.html">monstr_read_file</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="../reference/monstr_clean.html">monstr_clean</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/monstr_write_clean.html">monstr_write_clean</a></span><span class="op">(</span>format<span class="op">=</span><span class="st">"all"</span><span class="op">)</span></code></pre></div>
</div>
<div id="import-and-clean-population-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#import-and-clean-population-dataset" class="anchor"></a>Import and clean population dataset</h2>
<p>The cleaned data can be found in your root project folder under <code>data/clean/ons/</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ons_midyear_pop</span> <span class="op">&lt;-</span> <span class="fu">fread</span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>,<span class="st">"clean"</span>,<span class="st">"ons"</span>,<span class="st">"mid-year-pop-est"</span>,<span class="st">"mid-2019-april-2020-geography"</span>,<span class="st">"mid-year-pop-est-v1.csv"</span><span class="op">)</span>, header<span class="op">=</span><span class="cn">TRUE</span>, sep<span class="op">=</span><span class="st">","</span>, check.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span><span class="va">.</span>,population<span class="op">=</span><span class="va">v4_0</span><span class="op">)</span></code></pre></div>
<p>For this analysis, we will keep the number of deaths for all ages and both genders in each year and region.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ons_midyear_pop_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">ons_midyear_pop</span>,<span class="va">age</span><span class="op">==</span><span class="st">"Total"</span><span class="op">&amp;</span><span class="va">sex</span><span class="op">==</span><span class="st">"All"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">.</span>,<span class="va">population</span>,<span class="va">calendar_years</span>,<span class="va">admin_geography</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">.</span>,<span class="va">admin_geography</span>,<span class="fu">desc</span><span class="op">(</span><span class="va">calendar_years</span><span class="op">)</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ons_midyear_pop_total</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="pop_table.PNG" width="50%"></p>
</div>
<div id="import-and-clean-deaths-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#import-and-clean-deaths-dataset" class="anchor"></a>Import and clean deaths dataset</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ons_weekly_deaths_region</span> <span class="op">&lt;-</span> <span class="fu">fread</span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>,<span class="st">"clean"</span>,<span class="st">"ons"</span>,<span class="st">"weekly-deaths-region"</span>,<span class="st">"2010-19"</span>,<span class="st">"weekly-deaths-region-v1.csv"</span><span class="op">)</span>, header<span class="op">=</span><span class="cn">TRUE</span>, sep<span class="op">=</span><span class="st">","</span>, check.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span><span class="va">.</span>,nr_deaths<span class="op">=</span><span class="va">v4_1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">.</span>,<span class="va">admin_geography</span>,<span class="fu">desc</span><span class="op">(</span><span class="va">calendar_years</span><span class="op">)</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ons_weekly_deaths_region</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="pop_deaths.PNG" width="50%"></p>
<p>This data is currently presented as a weekly time series, with one row per week. We will aggregate it into a yearly time series, thus matching the ONS population dataset.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ons_weekly_deaths_region</span> <span class="op">&lt;-</span> <span class="fu">as.data.table</span><span class="op">(</span><span class="va">ons_weekly_deaths_region</span><span class="op">)</span>

<span class="va">ons_weekly_deaths_region_annual</span> <span class="op">&lt;-</span> <span class="va">ons_weekly_deaths_region</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  geography  <span class="op">=</span> <span class="fu">first</span><span class="op">(</span><span class="va">geography</span><span class="op">)</span>,
  nr_deaths<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">nr_deaths</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">calendar_years</span>,<span class="va">admin_geography</span><span class="op">)</span><span class="op">]</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ons_weekly_deaths_region_annual</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="pop_deaths_aggregate.PNG" width="50%"></p>
</div>
<div id="merge-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#merge-datasets" class="anchor"></a>Merge datasets</h2>
<p>We are now ready to merge our population data into our deaths data, which will allow us to compute a new variable: the death rate per 100,000 residents for a given region and year.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ons_weekly_deaths_region_annual</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">ons_weekly_deaths_region_annual</span>,
                                             <span class="va">ons_midyear_pop_total</span>,
                                             by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"calendar_years"</span> <span class="op">=</span> <span class="st">"calendar_years"</span>,
                                                  <span class="st">"admin_geography"</span> <span class="op">=</span> <span class="st">"admin_geography"</span><span class="op">)</span><span class="op">)</span>

<span class="va">ons_weekly_deaths_region_annual</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">ons_weekly_deaths_region_annual</span>,
                                          deaths_per_100K<span class="op">=</span><span class="va">nr_deaths</span><span class="op">/</span><span class="va">population</span><span class="op">*</span><span class="fl">100000</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ons_weekly_deaths_region_annual</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="merged_table.PNG" width="50%"></p>
</div>
<div id="present-results-in-a-chart" class="section level2">
<h2 class="hasAnchor">
<a href="#present-results-in-a-chart" class="anchor"></a>Present results in a chart</h2>
<p>Having used the <code>monstR</code> package to download our required ONS tables and processed the data, we are ready to display the mortality rate by year according to region.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ons_weekly_deaths_region_annual</span><span class="op">$</span><span class="va">bold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">ons_weekly_deaths_region_annual</span><span class="op">$</span><span class="va">geography</span><span class="op">==</span><span class="st">"England and Wales"</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">ons_weekly_deaths_region_annual</span>,
                    <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">calendar_years</span><span class="op">)</span>, y<span class="op">=</span><span class="va">deaths_per_100K</span>, group<span class="op">=</span><span class="va">geography</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color<span class="op">=</span><span class="va">geography</span>,size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">bold</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color<span class="op">=</span><span class="va">geography</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
        panel.border <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        legend.key<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Mortality rate by region in England and Wales"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Number of deaths per 100,000"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_brewer</span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set3"</span>,name <span class="op">=</span> <span class="st">"Region"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_size_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">1.25</span><span class="op">)</span>,guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">x</span>, big.mark <span class="op">=</span> <span class="st">","</span>,
                                                 scientific <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="mortality_by_region.png" width="50%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Neale Swinnerton, Emma Vestesson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
